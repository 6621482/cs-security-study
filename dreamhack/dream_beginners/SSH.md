# SSH

## SSH
- **SSH**(Secure Shell, Secure Socket Shell) : 원격 서버(컴퓨터)에 연결할 수 있도록 암호화된 네트워크 프로토콜
  - 암호화를 통해 호스트와 클라이언트가 안전하게 통신할 수 있음
  - 클라이언트가 원격 서버의 터미널에 접속하여 명령어를 입력하면, 호스트가 명령 실행 결과를 클라이언트에게 전달 
- `ssh user@host -p PORT -i [개인 키 파일 경로]`
  - 'user` : 원격 서버에 존재하는 계정 이름
    - SSH 접속은 **서버의 계정**으로 함 (항상 원격 서버에 이미 존재하는 계정으로 접속해야 함)
  - `HOST` : 접속하려는 원격 서버의 IP 또는 도메인 작성 
  - 특정 포트로 접속하고 싶은 경우 `-p` 옵션 이용 (SSH의 기본 포트 = 22)
  - `-i 개인키파일` : 공개키 인증을 쓸 때 사용하는 옵션
## 클라이언트가 믿을만한 사용자인지 인증하는 방법
(1) 패스워드로 인증
- `ssh user@HOST` 실행 : 패스워드를 입력한 뒤 원격 서버에 접속 가능
- 접속 과정
  - (1) 클라이언트가 SSH 서버에 접속 요청
  - (2) 서버가 비밀번호 인증을 허용한 경우, 사용자가 원격 서버 계정의 비밀번호 입력
  - (3) 서버가 비밀번호를 검증
  - (4) 일치하면 인증 성공 -> 접속 허용
- 패스워드를 충분히 긴 길이로 설정하지 않으면 브루트 포스 공격을 통해 패스워드를 유추할 수 있다는 위험 존재
  - 브루트 포스 공격 : 가능한 모든 비밀번호를 자동으로 다 시도하는 공격

(2) 공개키/ 개인키 인증
- 클라이언트 : 개인키 보관
- 서버 : 공개키 저장
- 접속 과정
  - (1) 클라이언트가 개인 키를 사용하겠다고 서버에 알림
  - (2) 서버가 임의의 메세지를 생성하여 서명 요청
  - (3) 클라이언트가 개인 키로 메세지에 서명
  - (4) 서버가 저장된 공개 키로 서명 검증
  - (5) 검증 성공 시 사용자 인증 완료
- 개인 키는 절대 네트워크로 전송되지 않음

## SSH 접속 과정
- (1) TCP 연결 시도
  - 클라이언트가 원격 서버의 SSH 포트 (기본 22)로 연결 요청
  - 이 단계에서는 아직 암호화되지 않음
- (2) 서버 신원 확인 (Host Key 검증)
  - 서버가 자신의 호스트 키를 제시
  - 클라이언트는 `known_hosts`를 통해 서버 신원 확인
  - 중간자 공격(MITM) 방지를 위한 단계
- (3) 키 교환
  - 클라이언트와 서버가 키 교환 알고리즘을 통해 세션 키 생성
    - 세션 키 : SSH 연결 과정에서 생성되는 임시 대칭 키
      - 연결이 유지되는 동안 클라이언트와 서버 간에 오가는 모든 데이터(명령어 입력, 실행 결과, 파일 전송 등)를 암호화하는 데 사용됨
    ```
    [명령어] --(세션 키로 암호화)--> [서버]
    [결과]  <--(세션 키로 암호화)--  [클라이언트]
    ```
- (4) 사용자 인증
  - 비밀번호 인증 또는 공개키/개인키 인증 수행
  - 인증 성공 시에만 접속 허용
- (5) 암호화된 세션 생성 및 쉘 제공
  - SSH 접속 시 서버에서 쉘이 실행되며, 클라리언트는 이를 원격으로 조작 
  - 사용자가 입력한 명령은 서버에서 실행되고 결과만 클라이언트로 전달
- 동작 : `[내 PC 터미널] --(암호화된 통신)-> [서버의 쉘]`
  - 사용자가 키보드로 입력하면 입력 내용이 암호화되어 서버로 전송되고, 서버의 쉘이 명령을 실행함 -> 실행 결과만 다시 사용자의 화면에 출력
