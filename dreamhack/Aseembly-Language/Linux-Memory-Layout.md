# Linux Memory Layout

## Linux Memory Layout
- 각 프로세스는 서로 독립된 가상 메모리 공간을 할당받고, 이 메모리 공간은 용도별로 여러 영역으로 나뉨
  - 각 영역에 부여되는 권한
    - 읽기(r)
    - 쓰기(w)
    - 실행(x)
  - CPU는 해당 메모리 영역에 부여된 권한 내에서만 동작할 수 있음
- 프로세스 메모리 세그먼트 구성
  ```sql
  높은 주소
  +------------------+
  | Stack Segment    |  ← 지역 변수, 함수 호출 - int foo() {int local = 0;}
  +------------------+
  | Heap Segment     |  ← malloc, free - int *ptr = malloc(4);
  +------------------+
  | BSS Segment      |  ← 초기화되지 않은 전역/정적 변수 - int intialized_global;
  +------------------+
  | Data Segment     |  ← 초기화된 전역/정적 변수 - int intialized_global = 0;
  +------------------+
  | Code Segment     |  ← 실행 코드 - int foo() {...}
  +------------------+
  낮은 주소
  ```
  - **코드 세그먼트(Code Segment)** : 프로그램의 실행 가능한 기계어 코드가 저장되는 영역
    - 권한 : r-x
    - 텍스트 세그먼트라고도 부름 
    - 생성 및 수명 : 프로그램 로드 시 생성되어 프로세스 종료 시까지 유지됨 
    - 보안 : 취약점을 이용해 해당 프로그램의 코드를 악성 코드로 수정할 수 있어 쓰기 권한이 제어됨
  - **데이터 세그먼트(Data Segment)** : 컴파일 시점에 값이 정해진 전역 변수 및 전역 상수들이 저장되는 영역
    - 실행 파일 안에 초기값이 실제로 저장됨
    - 생성 및 수명 : 프로그램 로드 시 생성되어 프로세스 종료 시까지 유지됨
    - data 세그먼트 : 전역 변수와 같이 프로그램이 실행되면서 값이 변할 수 있는 데이터들이 위치
      - 권한 : rw-
    - rodata(read-only data) 세그먼트 : 값이 변하면 안되는 데이터들이 위치 (const로 선언된 전역 변수나 리터럴 문자여링 저장되는 곳) 
      - 권한 : r--
  - **BSS 세그먼트(BSS Segment)** : 컴파일 시점에 값이 정해지지 않은 전역 변수가 위치하는 메모리 영역
    - 권한 : rw-
    - 생성 및 수명 : 프로그램 로드 시 생성되어 프로세스 종료 시까지 유지됨
    - 선언만 하고 초기화하지 않은 전역변수 등 -> 프로그램이 시작될 때 모두 0으로 값이 초기화됨
    - 실행 파일에는 크기 정보만 존재하고, 실제 값(0)은 메모리에서 할당 시 생성됨 
  - **힙 세그먼트(Heap Segment)** : 동적 메모리 할당을 위한 영역
    - 권한 : rw-
    - 생성 및 수명 : 런타임 중 필요할 때 할당되고, free() 전까지 유지됨
    - `malloc()`, `calloc()` 등을 호출해서 할당받는 메모리가 위치함
    - 낮은 주소에서 높은 주소 방향으로 자람 
  - **스택 세그먼트(Stack Segment)** : 프로세스의 스택이 위치하는 영역
    - 권한 : rw-
    - 생성 및 수명 : 함수 호출 시 자동으로 할당되어 함수 종료 시 자동으로 해제됨
    - 지역 변수, 함수 인자, 리턴 주소, 이전 프레임 정보 등이 저장됨
    - 높은 주소에서 낮은 주소 방향으로 자람
    - LIFO 구조로 관리됨
    - 스택 프레임 : 함수가 호출될 때 그 함수만을 위해 스택 영역에 할당되는 독립적인 공간 
      - 함수가 호출될 때 전달된 매개변수, 함수가 끝나고 돌아갈 반환 주소, 지역변수 저장
      - 함수의 독립성을 보장하고, 복귀 지점을 추적할 수 있음 
