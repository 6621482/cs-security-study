## Dreamhack - gdb

### 문제 유형
- GDB 디버깅 기방 리버싱
- 함수 리턴값 추적
- 함수 호출 흐름 제어

### 문제 요약
GDB를 사용해 프로그램을 디버깅하여 flag1, flag2 두 값을 찾아야 함  
flag1 : flag_1() 함수의 리턴값  
flag2 : flag_2()의 실행 결과 (실행 조건 : 특정 주소에서의 rax == 0이어야 함)

### 코드 분석 포인트
- break 설정 시 함수 엔트리에 걸린다는 점 이해해야 함
- disassemble을 통해 실행 흐름과 분기 조건을 이해해야 함
- flag_2가 조건부로 호출되는 함수임을 파악해야 함 

### 접근 과정
1. flag_1 함수 시작에 중단점 설정
2. 함수 끝까지 실행
3. context 통해 리턴 직후 rax 값 확인
4. flag_2 직전 주소에서 rax == 0 조건 확인 
5. 해당 시점에 중단점 걸고 rax 값 조작 
6. flag_2 함수 실행

### 어려웠던 점
- b <함수명>이 call 지점에 걸리는 것으로 오해함
  - 이로 인해 flag_1에 break 설정 후 run, ni를 차례로 실행하여 rax 값을 제대로 구하지 못함
- run <함수명>을 함수 실행 명령으로 착각
- 실행 흐름을 이어야 할 상황에서 run을 사용해 프로그램을 재시작함

### 배운 점
- b <함수명>은 call 지점이 아니라 함수 엔트리에 걸림
- ni는 call 지점에서만 함수 전체를 실행함
- 함수 내부에서 함수 전체를 실행하려면 finish 명령어를 사용해야 함
- 실행 흐름을 유지하려면 run이 아닌 continue를 사용해야 함
- 디버거에서 화살표(=>)는 아직 실행되지 않은, 다음에 실행될 명령어를 의미함 

### 쓰인 개념
- GDB 명령어
  - run, continue, ni, finish, break, disassemble
- x86-64 규약
  - 함수 리턴값은 rax 레지스터에 저장됨
