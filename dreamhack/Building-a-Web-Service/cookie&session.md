# Cookie & Session

## Cookie
- 정의 : 서버가 클라이언트에게 발급하는 Key-Value 형태의 작은 데이터 조각
  - HTTP에서 상태를 유지하기 위해 쿠키를 사용함
- 저장 위치 : 서버가 아닌 클라이언트의 로컬 환경(브라우저의 쿠키 저장소)에 파일 또는 메모리 형태로 저장됨
  - 서버의 제어권을 벗어나 클라이언트가 데이터에 직접 접근할 수 있음 
- 쿠키가 필요한 이유 (HTTP 특징) 
  - **Connectionless** : 하나의 요청에 응답한 후 바로 연결을 종료함 -> 매번 새로운 연결을 맺어야 함
  - **Stateless** : 통신이 끝난 후 클라이언트의 상태 정보를 저장하지 않음 -> 서버는 방금 통신한 상대가 누구인지 기억 못 함
- 동작  
  (1) 서버가 클라이언트에게 쿠키를 전달함  
  (2) 클라이언트는 이를 보관하고 있다가 서버에 요청을 보낼 때 쿠키를 같이 전송함  
  (3) 서버는 쿠키 내용을 확인해 클라이언트를 식별함
- 용도
  - 정보 기록(Information Tracking)
    - 팝업 제어 : "오늘 하루 이 창을 열지 않음" 버튼을 누르면 그 정보를 쿠키에 담아 팝업이 뜨지 않게 조절함
    - 참고: 쿠키는 매 요청마다 서버로 전송되어 리소스를 소비하므로, 최근에는 **Modern Storage API(Local Storage 등)**를 사용하는 추세임
  - 상태 정보(State Management)
    - 로그인 유지 : 사용자가 로그인했음을 증명하는 식별 값을 쿠키에 저장하여, 페이지를 이동해도 로그인이 풀리지 않게 함
    - 개인화 서비스: 사용자별 맞춤형 환경설정을 유지하는 데 사용됨
- 취약점
  - 쿠키 변조 : 쿠키가 클라이언트의 로컬에 저장된다는 점을 이용한 공격 방식
    - 공격 원리 : 클라이언트는 자신의 컴퓨터에 저장된 쿠키 값을 임의로 수정할 수 있음
    - 결과 : 악의적인 사용자가 쿠키 내의 인증 정보를 타인의 정보로 변조하여 서버에 보낼 경우, 서버가 별도의 검증 없이 이를 신뢰하면 타인 사칭 및 정보 탈취가 발생함 

## Session
- 정의 : 서버가 클라이언트의 상태를 유지하기 위해 할당하는 논리적인 연결 상태
  - 쿠키에 인증 상태를 저장하지만 클라이언트가 인증 정보를 변조할 수 없게 하기 위해 사용함 
- 세션의 작동 원리
  - (1) Session ID 생성 및 서버 측 데이터 저장  
    - 클라이언트의 요청 : 사용자가 로그인 정보(ID/PW)를 담아 서버에 요청을 보냄  
    - 서버의 처리 : 서버는 인증이 성공하면, 해당 사용자를 위한 고유한 Session ID(유추 불가능한 랜덤 문자열)를 생성함  
  - (2) Session ID 전달 및 클라이언트 저장
    - 전달 방식 : 서버는 생성된 Session ID를 HTTP 응답 헤더인 Set-Cookie에 담아 클라이언트로 보냄
    - 저장 위치(Client-side) : 클라이언트(브라우저)는 응답을 받은 후, 전달받은 Session ID를 자신의 **쿠키 저장소(Cookie Storage)** 에 보관함
      - 실제 사용자 정보는 서버에 있고, 클라이언트는 오직 서버의 데이터를 열 수 있는 세션 ID만 가지게 됨
  - (3) 인증 요청 및 서버 측 검증
    - 요청 시 데이터 이동: 이후 클라이언트가 서버에 다른 페이지를 요청할 때, 브라우저는 쿠키 저장소에 있던 Session ID를 Cookie 헤더에 실어서 자동으로 서버에 전송함
    - 서버의 검증 로직
      - 서버는 HTTP 요청 헤더에서 Session ID를 추출함
      - 서버는 추출한 ID를 사용하여 자신의 세션 저장소를 조회함
      - 해당 ID와 일치하는 데이터가 존재하고 만료되지 않았다면, 서버는 이를 유효한 사용자로 판단하여 요청을 처리함
- 데이터 저장 위치 비교
  - 서버
    - 저장 위치 : 세션 저장소(Memory, DB, Redis 등)
    - 저장 내용 : 실제 인증 상태 정보, 권한, 유효 시간 등 (Full Data)
  - 클라이언트
    - 저장 위치 : 브라우저 쿠키(Cookie Storage)
    - 저장 내용 : 서버의 데이터를 조회하기 위한 Session ID (Key)

